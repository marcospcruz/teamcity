<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" uuid="c55956e8-619c-4c82-b380-56864067ea38" xsi:noNamespaceSchemaLocation="https://www.jetbrains.com/teamcity/schemas/2021.1/project-config.xsd">
  <name>Angular App</name>
  <parameters />
  <project-extensions>
    <extension id="PROJECT_EXT_5" type="CloudImage">
      <parameters>
        <param name="agentNamePrefix" value="kubernetes-agent" />
        <param name="agent_pool_id" value="-2" />
        <param name="customPodTemplate"><![CDATA[apiVersion: v1
kind: Pod
spec:
  containers:
  - image: debian:latest
    imagePullPolicy: IfNotPresent
    name: deploy-pod
    command: |
    # Point to the internal API server hostname
    APISERVER=https://kubernetes.default.svc

	# Path to ServiceAccount token
	SERVICEACCOUNT=/var/run/secrets/kubernetes.io/serviceaccount

	# Read this Pod's namespace
	NAMESPACE=$(cat ${SERVICEACCOUNT}/namespace)

	# Read the ServiceAccount bearer token
	TOKEN=$(cat ${SERVICEACCOUNT}/token)

	# Reference the internal certificate authority (CA)
	CACERT=${SERVICEACCOUNT}/ca.crt

	# Explore the API with TOKEN
	curl --cacert ${CACERT} --header "Authorization: Bearer ${TOKEN}" -X GET ${AP
    kubectl config set-cluster e2e --embed-certs --certificate-authority=$CACERT \
    kubectl cluster-info
    #kubectl \
    #--token "Authorization: Bearer ${TOKEN}" \]]></param>
        <param name="imageDescription" value="Custom pod template: kubernetes-agent" />
        <param name="imageInstanceLimit" value="1" />
        <param name="podTemplateMode" value="custom-pod-template" />
        <param name="profileId" value="kube-3" />
        <param name="source-id" value="kubernetes-agent" />
      </parameters>
    </extension>
    <extension id="kube-3" type="CloudProfile">
      <parameters>
        <param name="apiServerUrl" value="https://192.168.65.23:6443" />
        <param name="authStrategy" value="client-cert" />
        <param name="cloud-code" value="kube" />
        <param name="description" value="" />
        <param name="enabled" value="true" />
        <param name="name" value="kubernetes cluster" />
        <param name="next-hour" value="5" />
        <param name="podTemplateMode" value="notSelected" />
        <param name="profileId" value="kube-3" />
        <param name="profileInstanceLimit" value="2" />
        <param name="secure:clientCertData" value="credentialsJSON:814731c3-664c-4c77-a509-2619b67f49f1" />
        <param name="secure:clientKeyData" value="credentialsJSON:c8096d62-1887-4150-bfe9-ca04e5af3ee6" />
        <param name="system.cloud.profile_id" value="kube-3" />
        <param name="terminate-after-build" value="true" />
        <param name="terminate-idle-time" value="30" />
      </parameters>
    </extension>
  </project-extensions>
  <cleanup />
</project>

